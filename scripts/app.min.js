!function(){"use strict";var module=angular.module("cart",[]);module.value("catalogItems",[{title:"AngularJSリファレンス",cost:4104},{title:"Webアプリ構築のためのAngularJS",cost:2070},{title:"AngularJSアプリケーション開発ガイド",cost:2592}])}(),function(){"use strict";function CartCtrl(cartStore,cartActions){this.cartStore=cartStore,this.cartActions=cartActions,cartStore.addListener(function(_this){return function(){return _this.resetItems()}}(this)),this.resetItems=function(){this.items=this.cartStore.items()},this.removeItem=function(item){this.cartActions.removeItem(item)},this.resetItems()}angular.module("cart").controller("cartCtrl",CartCtrl)}(),function(){"use strict";function CatalogCtrl(catalogItems,cartActions){this.cartActions=cartActions,this.items=catalogItems,this.addItem=function(item){this.cartActions.addItem(item)}}angular.module("cart").controller("catalogCtrl",CatalogCtrl)}(),function(){"use strict";function Dispatcher(){this.listeners=[]}Dispatcher.prototype.emit=function(event){this.listeners.forEach(function(listener){listener(event)})},Dispatcher.prototype.addListener=function(event){return this.listeners.push(event),this.listeners.length-1},angular.module("cart").service("dispatcher",Dispatcher)}(),function(){"use strict";function CartActions(dispatcher){return{addItem:function(item){return dispatcher.emit({actionType:"add",item:item})},removeItem:function(item){return dispatcher.emit({actionType:"remove",item:item})}}}angular.module("cart").factory("cartActions",CartActions)}(),function(){"use strict";function CartStore(dispatcher){function Store(){this.items=[],dispatcher.constructor.call(this)}Store.prototype=Object.create(dispatcher.constructor.prototype),Store.prototype.constructor=Store,Store.prototype.addItem=function(item){console.log("add to cart -> "+item.title);var storedItems=this.items.filter(function(storedItem){return storedItem.catalogItem===item});0===storedItems.length?this.items.push({qty:0,catalogItem:item}):storedItems[0].qty+=1},Store.prototype.removeItem=function(item){console.log("remove from cart -> "+item.catalogItem.title);var index=this.items.indexOf(item);this.items.splice(index,1)},Store.prototype.emitChange=function(){console.log("emit change"),this.emit()};var store=new Store;return dispatcher.addListener(function(action){switch(action.actionType){case"add":store.addItem(action.item);break;case"remove":store.removeItem(action.item);break;default:console.log("invalid actionType -> "+action.actionType)}store.emitChange()}),{addListener:function(listener){store.addListener(listener)},items:function(){return store.items}}}angular.module("cart").factory("cartStore",CartStore)}();